print "START"

set counter 0

proc printer () {
    print "printer started"
    sleep 500
    read.no_wait | foreach line {
        print "> $line"
    }
    print "printer ended"
    incr $counter
}

set p [spawn {printer}]
range 4 | foreach x {
    send $p $x
}

assert ($counter == 0)

# After some time:
# assert ($counter == 5)

print "END"
